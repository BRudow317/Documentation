# AWS Serverless Application Model (AWS SAM)

The primary tools you use to develop your application are the 
- [AWS SAM CLI](#SAMCLI)
  - `sam init` -- creates a new AWS SAM project
  - `sam build` -- builds your serverless application
- [AWS SAM template](#SAMTemplate) -- a CloudFormation template file that defines the AWS resources in your serverless application
  - [Template Sections](#TemplateSections) -- describes the major sections of an AWS SAM template file
- [AWS SAM project (which is your application project directory)](#SAMProject) -- contains your AWS SAM template file, source code, and any additional files that are required to build and deploy your serverless application

## Links
- [SAM Developer Guide](https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/sam-specification-template-anatomy.html)
- [SAM CLI Command Reference](https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/using-sam-cli-corecommands.html)
- [AWS SAM CLI User Guide](https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/what-is-sam.html)
- [Terraform Documentation](https://developer.hashicorp.com/terraform/docs)
- [AWS Chalice -- A framework for writing serverless applications in Python.](https://github.com/aws/chalice)
- [AWS Glossary](https://docs.aws.amazon.com/glossary/latest/reference/glos-chap.html)
- [AWS Solutions Library](https://aws.amazon.com/solutions/)

# AWS Cloud Development Kit (AWS CDK)
[AWS CDK](https://docs.aws.amazon.com/cdk/v2/guide/getting-started.html) consists of two primary parts:
- **[AWS CDK Construct Library](https://docs.aws.amazon.com/cdk/api/v2/docs/aws-construct-library.html)** –- A collection of pre-written modular and reusable pieces of code, called constructs, that you can use, modify, and integrate to develop your infrastructure quickly. The goal of the AWS CDK Construct Library is to reduce the complexity required to define and integrate AWS services together when building applications on AWS.
- **[AWS CDK Toolkit](https://docs.aws.amazon.com/cdk/v2/guide/cli.html)** -- Tools that you can use to manage and interact with your CDK apps, such as performing synthesis or deployment. The CDK Toolkit consists of: 
  - [CDK CLI](https://docs.aws.amazon.com/cdk/v2/guide/ref-cli-cmd.html) -- a command line tool 
  - [CDK Toolkit Library](https://docs.aws.amazon.com/cdk/v2/guide/toolkit-library.html) -- a programmatic library

## Additional CDK Resources
- [AWS CDK Developer Guide](https://docs.aws.amazon.com/cdk/latest/guide/home.html)
- [AWS CDK API Reference](https://docs.aws.amazon.com/cdk/api/v2/docs/aws-construct-library.html)
- [AWS CDK GitHub Repository](https://github.com/aws/aws-cdk)
- [AWS CDK Core Concepts](https://docs.aws.amazon.com/cdk/v2/guide/core-concepts.html)
- [CDK for Terraform](https://www.terraform.io/docs/cdktf/index.html)
- [CDK for Kubernetes (cdk8s)](https://cdk8s.io/)
- [Projen -- Building project configuration tool](https://github.com/projen/projen)

# SAM CLI
To use the AWS SAM CLI, you must first install it and then configure it to use your AWS credentials see AWS [SAM CLI User Guide](https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/using-sam-cli-configure.html).

## [SAM CLI Config File](https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/serverless-sam-cli-config.html)

The SAM Config file should be located at the project root and should be named 
- `samconfig.toml` 
  - This file is automatically generated when you run the `sam deploy --guided` command for the first time. It stores default configuration values for your AWS SAM CLI commands, allowing you to avoid re-entering the same parameters each time you run a command.
- `samconfig.yaml` or `samconfig.yml`
- Specify the configuration file to use with the `--config-file` option followed by the file name.

- ### Environment
  - An **environment** is a named set of configuration values that you can define in the configuration file. Each environment can have its own set of parameters for different AWS SAM CLI commands. This allows you to easily switch between different configurations, such as development, staging, and production environments.
  - The default **environment** name is `default`
  - `--config-env` option to specify the environment to use
- ### Command
  - **command** is the AWS SAM CLI command to specify parameter values
  - To specify parameter values for all commands, use the `global` identifier.
  - When referencing an AWS SAM CLI command, **replace spaces ( ) and hyphens (–) with underscores (_)**
- ### Parameter
  - **parameter** is the specific parameter for the AWS SAM CLI command that you want to set a value for.
  - Parameters are specified as **key-value pairs**
    - The **key** is the AWS SAM CLI command option name.
    - The **value** is the value to specify.
  - Each parameter is defined under its respective command section in the configuration file.

toml example
```toml
version = 0.1
[environment]
[environment.command]
[environment.command.parameters]
option = parameter value
```

yaml example
```yaml
version: 0.1
environment:
  command:
    parameters:
      option: parameter value
```

#### Sample SAM Config File (samconfig.toml)
```toml
...
version = 0.1

[default]
[default.global]
[default.global.parameters]
stack_name = "sam-app"

[default.build.parameters]
cached = true
parallel = true

[default.deploy.parameters]
capabilities = "CAPABILITY_IAM"
confirm_changeset = true
resolve_s3 = true

[default.sync.parameters]
watch = true

[default.local_start_api.parameters]
warm_containers = "EAGER"

[prod]
[prod.sync]
[prod.sync.parameters]
watch = false
```

## Transform declaration
The declaration Transform: AWS::Serverless-2016-10-31 is required for AWS SAM template files. This declaration identifies an CloudFormation template file as an AWS SAM template file. For more information about transforms, see Transform in the AWS CloudFormation User Guide.

## Globals section
The Globals section is unique to AWS SAM. It defines properties that are common to all your serverless functions and APIs. All the AWS::Serverless::Function, `AWS::Serverless::Api`, `AWS::Serverless::CapacityProvider`, `AWS::Serverless::HttpApi`, `AWS::Serverless::SimpleTable`, and `AWS::Serverless::StateMachine` resources inherit the properties that are defined in the Globals section. For more information about this section, see Globals section of the AWS SAM template.

## Resources section
In AWS SAM templates the Resources section can contain a combination of CloudFormation resources and AWS SAM resources. For more information about CloudFormation resources, see AWS resource and property types reference in the AWS CloudFormation User Guide. For more information about AWS SAM resources, see AWS SAM resources and properties.

All other sections of an AWS SAM template file correspond to the CloudFormation template file section of the same name.

## YAML

The following example shows a YAML-formatted template fragment.

```yaml
Transform: AWS::Serverless-2016-10-31

Globals:
  set of globals

Description:
  String

Metadata:
  template metadata

Parameters:
  set of parameters

Mappings:
  set of mappings

Conditions:
  set of conditions

Resources:
  set of resources

Outputs:
  set of outputs
Template sections
```
# Template Sections

AWS SAM templates can include several major sections. Only the Transform and Resources sections are required.

You can include template sections in any order. However, if using language extensions, you should add `AWS::LanguageExtensions` before the serverless transform (that is, before `AWS::Serverless-2016-10-31`) as shown in the following example:

```yaml
Transform:
  - AWS::LanguageExtensions
  - AWS::Serverless-2016-10-31
```
As you build your template, it can be helpful to use the logical order that's shown in the following list. This is because the values in one section might refer to values from a previous section.

## Transform (required)
For AWS SAM templates, you must include this section with a value of AWS::Serverless-2016-10-31.

Additional transforms are optional. For more information about transforms, see Transform in the AWS CloudFormation User Guide.

## Globals (optional)
Properties that are common to all your serverless functions, APIs, and simple tables. All the AWS::Serverless::Function, AWS::Serverless::Api, AWS::Serverless::CapacityProvider, AWS::Serverless::HttpApi, AWS::Serverless::SimpleTable, and AWS::Serverless::StateMachine resources inherit the properties that are defined in the Globals section.

This section is unique to AWS SAM. There isn't a corresponding section in CloudFormation templates.

## Description (optional)
A text string that describes the template.

This section corresponds directly with the Description section of CloudFormation templates.

## Metadata (optional)
Objects that provide additional information about the template.

This section corresponds directly with the Metadata section of CloudFormation templates.

## Parameters (optional)
Values to pass to your template at runtime (when you create or update a stack). You can refer to parameters from the Resources and Outputs sections of the template. Objects that are declared in the Parameters section cause the sam deploy --guided command to present additional prompts to the user.

Values that are passed in using the --parameter-overrides parameter of the sam deploy command—and entries in the configuration file—take precedence over entries in the AWS SAM template file. For more information about the sam deploy command, see sam deploy in the AWS SAM CLI command reference. For more information about the configuration file, see AWS SAM CLI configuration file.

## Mappings (optional)
A mapping of keys and associated values that you can use to specify conditional parameter values, similar to a lookup table. You can match a key to a corresponding value by using the Fn::FindInMap intrinsic function in the Resources and Outputs sections.

This section corresponds directly with the Mappings section of CloudFormation templates.

## Conditions (optional)
Conditions that control whether certain resources are created or whether certain resource properties are assigned a value during stack creation or update. For example, you could conditionally create a resource that depends on whether the stack is for a production or test environment.

This section corresponds directly with the Conditions section of CloudFormation templates.

## Resources (required)
The stack resources and their properties, such as an Amazon Elastic Compute Cloud (Amazon EC2) instance or an Amazon Simple Storage Service (Amazon S3) bucket. You can refer to resources in the Resources and Outputs sections of the template.

This section is similar to the Resources section of CloudFormation templates. In AWS SAM templates, this section can contain AWS SAM resources in addition to CloudFormation resources.

## Outputs (optional)
The values that are returned whenever you view your stack's properties. For example, you can declare an output for an S3 bucket name, and then call the aws cloudformation describe-stacks AWS Command Line Interface (AWS CLI) command to view the name.

This section corresponds directly with the Outputs section of CloudFormation templates.


## Other IaC Tools for SAM and SAM Installations
- [Install AWS SAM CLI](https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/install-sam-cli.html)
- [AWS CDK](https://docs.aws.amazon.com/cdk/latest/guide/home.html)
- [AWS Toolkit for Visual Studio Code](https://docs.aws.amazon.com/toolkit-for-vscode/latest/userguide/setup-toolkit.html)
- [Docker (Required for local testing and building of Lambda functions)](https://www.docker.com/)
- [AWS SAM templates](#TemplateSections) – Provides native support with the full feature set, including local testing, debugging, packaging, and deployment capabilities.
- AWS CDK applications – Supports local testing of Lambda functions after you synthesize the AWS CDK application to CloudFormation templates.
  - `cdk synth` command – Generates CloudFormation templates from your AWS CDK application.
- [CloudFormation templates](https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/Welcome.html) – Offers direct compatibility because AWS SAM extends CloudFormation, supporting serverless resources that are defined in standard CloudFormation templates.
- [Terraform applications](https://developer.hashicorp.com/terraform/docs) – Provides limited support for building and local testing of Lambda functions. Requires you to generate AWS SAM template artifacts that represent your Terraform-defined Lambda functions.